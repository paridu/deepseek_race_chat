import streamlit as st
import requests
import json

def call_openrouter_api(prompt, api_key, site_url=None, site_name=None):
    url = "https://openrouter.ai/api/v1/chat/completions"
    
    headers = {
        "Authorization": f"Bearer {api_key}",
        "Content-Type": "application/json",
        "HTTP-Referer": site_url or "",  # ‡∏£‡∏∞‡∏ö‡∏∏ URL ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        "X-Title": site_name or ""        # ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
    }
    
    data = {
        "model": "deepseek/deepseek-r1-distill-llama-70b:free",
        "messages": [{
            "role": "user", 
            "content": f"‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏©‡∏≤‡∏Ç‡∏≠‡∏á Prompt ‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡πÇ‡∏î‡∏¢‡∏Ñ‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á RACE Framework ‡∏î‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏¥‡∏°:\n\n{prompt}"
        }],
        "temperature": 0.7,
        "max_tokens": 2000
    }

    try:
        with st.spinner("üîÆ AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Prompt ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..."):
            response = requests.post(url, headers=headers, json=data)
            response.raise_for_status()  # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å API
            
            result = response.json()  # ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å API
            return result['choices'][0]['message']['content']
            
    except requests.exceptions.HTTPError as e:
        # ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏à‡∏≤‡∏Å HTTP Request
        error_info = e.response.json().get('error', {})
        error_code = error_info.get('code', 'unknown')
        error_message = error_info.get('message', 'Unknown error')
        
        st.error(f"‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î {e.response.status_code} ({error_code}): {error_message}")
        
        if e.response.status_code == 402:
            st.markdown("""
            üí° ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:
            1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô [OpenRouter Dashboard](https://openrouter.ai/account)
            2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÉ‡∏ô [OpenRouter Pricing](https://openrouter.ai/pricing)
            """)
        return None
        
    except requests.exceptions.ConnectionError:
        st.error("üö® ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå OpenRouter ‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì")
        return None

    except requests.exceptions.Timeout:
        st.error("üö® ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á")
        return None

    except Exception as e:
        st.error(f"üö® ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î: {str(e)}")
        return None


# ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏î‡πâ‡∏ß‡∏¢ Streamlit
st.set_page_config(page_title="RACE Prompt Generator", page_icon="üöÄ", layout="wide")

with st.sidebar:
    st.header("‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤")
    api_key = st.text_input("OpenRouter API Key", type="password", help="‡∏£‡∏±‡∏ö API Key ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà: https://openrouter.ai/keys")
    site_url = st.text_input("‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)", placeholder="https://your-website.com")
    site_name = st.text_input("‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)", placeholder="My Awesome App")
    
    st.markdown("---")
    st.markdown("""
    **üìö ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**
    1. ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏° RACE Framework
    2. ‡πÉ‡∏™‡πà OpenRouter API Key
    3. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á Prompt
    4. ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
    """)

st.title("üöÄ RACE Framework Prompt Generator")
st.caption("‡∏™‡∏£‡πâ‡∏≤‡∏á Prompt ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏î‡πâ‡∏ß‡∏¢ AI ‡∏à‡∏≤‡∏Å OpenRouter")

with st.expander("‚ÑπÔ∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô", expanded=True):
    st.markdown("""
    **RACE Framework Structure:**
    1. **Role** - ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏Ç‡∏≠‡∏á AI
    2. **Action** - ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ó‡∏≥
    3. **Context** - ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
    4. **Explanation** - ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
    5. **Example Output** - ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
    6. **Tips** - ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏û‡∏¥‡πÄ‡∏®‡∏©
    """)

form_data = {}
with st.form("race_form"):
    cols = st.columns(2)
    with cols[0]:
        form_data['role'] = st.text_area(
            "1. Role", 
            placeholder="""‡πÄ‡∏ä‡πà‡∏ô '‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ä‡∏ü‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∏‡∏á "‡∏ï‡πâ‡∏°‡πÑ‡∏Ç‡πà‡∏¢‡∏≤‡∏á‡∏°‡∏∞‡∏ï‡∏π‡∏°" ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏¥‡∏¢‡∏°‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ß‡πÑ‡∏ó‡∏¢'""",
            height=150
        )
        
        form_data['context'] = st.text_area(
    "3. Context", 
    placeholder="""‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÑ‡∏ó‡∏¢ ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡∏´‡∏≤‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡∏Å‡∏•‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∏‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏ñ‡∏µ‡∏û‡∏¥‡∏ñ‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡∏â‡∏ö‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÑ‡∏ó‡∏¢‡πÅ‡∏ó‡πâ'""",
    height=150
)

        
        form_data['example_output'] = st.text_area(
            "5. Example Output", 
             placeholder="""‡πÄ‡∏ä‡πà‡∏ô'‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:
                            - ‡πÑ‡∏Ç‡πà‡πÑ‡∏Å‡πà‡∏™‡∏î 6 ‡∏ü‡∏≠‡∏á
                            - ‡∏ô‡πâ‡∏≥‡∏™‡∏∞‡∏≠‡∏≤‡∏î 1 ‡∏•‡∏¥‡∏ï‡∏£
                            - ‡∏ï‡∏∞‡πÑ‡∏Ñ‡∏£‡πâ 2 ‡∏ï‡πâ‡∏ô (‡∏ó‡∏∏‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡∏Å)
                            - ‡πÉ‡∏ö‡∏°‡∏∞‡∏Å‡∏£‡∏π‡∏î 3-4 ‡πÉ‡∏ö (‡∏â‡∏µ‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏¥‡πâ‡∏ô)
                            - ‡∏´‡∏≠‡∏°‡πÅ‡∏î‡∏á 3 ‡∏´‡∏±‡∏ß (‡∏õ‡∏≠‡∏Å‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å)
                            - ‡∏û‡∏£‡∏¥‡∏Å‡πÑ‡∏ó‡∏¢ 1 ‡∏ä‡πâ‡∏≠‡∏ô‡∏ä‡∏≤
                            - ‡πÄ‡∏Å‡∏•‡∏∑‡∏≠ 1/2 ‡∏ä‡πâ‡∏≠‡∏ô‡∏ä‡∏≤
                            - ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• 1 ‡∏ä‡πâ‡∏≠‡∏ô‡∏ä‡∏≤
                            - ‡∏ã‡∏≠‡∏™‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏™ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
                            
                            ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:
                            1. ‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏Ç‡πà‡πÉ‡∏´‡πâ‡∏™‡∏∞‡∏≠‡∏≤‡∏î ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡πà‡∏á‡∏™‡∏Å‡∏õ‡∏£‡∏Å‡∏ï‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà
                            2. ‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏´‡∏°‡πâ‡∏≠‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏ó‡πà‡∏ß‡∏°‡πÑ‡∏Ç‡πà ‡∏ô‡∏≥‡πÑ‡∏õ‡∏ï‡πâ‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏î‡∏∑‡∏≠‡∏î ‡πÉ‡∏™‡πà‡∏ï‡∏∞‡πÑ‡∏Ñ‡∏£‡πâ, ‡πÉ‡∏ö‡∏°‡∏∞‡∏Å‡∏£‡∏π‡∏î, ‡πÅ‡∏•‡∏∞‡∏´‡∏≠‡∏°‡πÅ‡∏î‡∏á‡∏•‡∏á‡πÑ‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏´‡∏≠‡∏°
                            3. ‡πÉ‡∏™‡πà‡πÑ‡∏Ç‡πà‡∏•‡∏á‡πÉ‡∏ô‡∏ô‡πâ‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡πà‡∏≠‡∏ô‡πÇ‡∏¢‡∏ô ‡∏•‡∏î‡πÑ‡∏ü‡∏•‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡πâ‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 8-10 ‡∏ô‡∏≤‡∏ó‡∏µ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏Ç‡πà‡∏™‡∏∏‡∏Å‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á)
                            4. ‡∏´‡∏•‡∏±‡∏á‡∏ï‡πâ‡∏°‡∏Ñ‡∏£‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ ‡∏ô‡∏≥‡πÑ‡∏Ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏û‡∏±‡∏Å‡πÉ‡∏ô‡∏ô‡πâ‡∏≥‡πÄ‡∏¢‡πá‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏Å‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏Ç‡πà‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏≠‡∏Å
                            5. ‡∏õ‡∏≠‡∏Å‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏Ç‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏∏‡∏Å‡πÄ‡∏Ñ‡∏•‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∏‡∏á (‡πÄ‡∏Å‡∏•‡∏∑‡∏≠, ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•, ‡∏ã‡∏≠‡∏™‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏™) ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏≠‡∏ö ‡∏à‡∏±‡∏î‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÉ‡∏ô‡∏à‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÇ‡∏£‡∏¢‡∏û‡∏£‡∏¥‡∏Å‡πÑ‡∏ó‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
                            '""",
                                        height=150
                                    )

    with cols[1]:
        form_data['action'] = st.text_area(
            "2. Action", 
            placeholder="""‡πÄ‡∏ä‡πà‡∏ô '‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏•‡∏∞‡∏™‡∏≠‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∏‡∏á "‡∏ï‡πâ‡∏°‡πÑ‡∏Ç‡πà‡∏¢‡∏≤‡∏á‡∏°‡∏∞‡∏ï‡∏π‡∏°" ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∏‡∏á'""",
            height=150
        )
        
        form_data['explanation'] = st.text_area(
            "4. Explanation", 
           placeholder="""‡πÄ‡∏ä‡πà‡∏ô '‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏Ç‡πà‡πÑ‡∏Å‡πà‡∏™‡∏î, ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏® (‡∏ï‡∏∞‡πÑ‡∏Ñ‡∏£‡πâ, ‡πÉ‡∏ö‡∏°‡∏∞‡∏Å‡∏£‡∏π‡∏î, ‡∏´‡∏≠‡∏°‡πÅ‡∏î‡∏á, ‡∏û‡∏£‡∏¥‡∏Å‡πÑ‡∏ó‡∏¢), ‡πÄ‡∏Å‡∏•‡∏∑‡∏≠, ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• ‡πÅ‡∏•‡∏∞‡∏ã‡∏≠‡∏™‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏™ ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö '""",
            height=150
        )
        
        form_data['tips'] = st.text_area(
            "6. Tips", 
            placeholder="‡πÉ‡∏ä‡πâ‡∏ô‡πâ‡∏≥‡πÄ‡∏¢‡πá‡∏ô‡∏ä‡πá‡∏≠‡∏Ñ‡πÑ‡∏Ç‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏ï‡πâ‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏Ç‡πà‡∏´‡∏¢‡∏∏‡∏î‡∏™‡∏∏‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ï‡∏Å‡∏á‡πà‡∏≤‡∏¢ '",
            height=150
        )

    submitted = st.form_submit_button("‚ú® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Prompt")

if submitted:
    if not api_key:
        st.error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å OpenRouter API Key!")
        st.stop()
        
    if not all(form_data.values()):
        st.error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°")
        st.stop()

    raw_prompt = f"""
### 1. Role
{form_data['role']}

### 2. Action
{form_data['action']}

### 3. Context
{form_data['context']}

### 4. Explanation
{form_data['explanation']}

### 5. Example Output
{form_data['example_output']}

### 6. Tips
{form_data['tips']}
    """
    st.subheader("Prompt ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡πâ‡∏ß")
    result = call_openrouter_api(raw_prompt, api_key, site_url, site_name)
    
    if result:
        st.markdown(f"```{result}```")
        st.download_button("üíæ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Prompt", result, file_name="generated_prompt.txt", mime="text/plain")
